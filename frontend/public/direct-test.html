<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct Chart Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .chart-container { margin: 20px 0; }
        img { max-width: 100%; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Direct Chart Test</h1>

    <div class="test-section">
        <h2>Direct URL Test</h2>
        <p>Testing the exact URL from AI response:</p>
        <div class="chart-container">
            <img src="https://quickchart.io/chart?width=200&c=%7B%22type%22%3A%22bar%22%2C%22data%22%3A%7B%22labels%22%3A%5B%22Kedah%22%2C%22Selangor%22%5D%2C%22datasets%22%3A%5B%7B%22label%22%3A%22Population%202015%22%2C%22data%22%3A%5B2045300%2C6231800%5D%2C%22backgroundColor%22%3A%5B%22rgba(75%2C%20192%2C%20192%2C%200.2)%22%2C%22rgba(54%2C%20162%2C%20235%2C%200.2)%22%5D%2C%22borderColor%22%3A%5B%22rgba(75%2C%20192%2C%20192%2C%201)%22%2C%22rgba(54%2C%20162%2C%20235%2C%201)%22%5D%2C%22borderWidth%22%3A1%7D%5D%7D%2C%22options%22%3A%7B%22scales%22%3A%7B%22yAxes%22%3A%5B%7B%22ticks%22%3A%7B%22max%22%3A7000000%2C%22min%22%3A0%2C%22stepSize%22%3A1000000%2C%22beginAtZero%22%3Atrue%7D%2C%22stacked%22%3Afalse%7D%5D%2C%22xAxes%22%3A%7B%22stacked%22%3Afalse%7D%7D%2C%22plugins%22%3A%7B%22title%22%3A%7B%22display%22%3Atrue%2C%22text%22%3A%22Total%20Population%20Comparison%20between%20Kedah%20and%20Selangor%20in%202015%22%7D%2C%22legend%22%3A%7B%22display%22%3Atrue%2C%22position%22%3A%22top%22%7D%7D%7D%7D"
                 alt="Population Chart"
                 onload="this.style.border='2px solid green'; console.log('‚úÖ Direct chart loaded successfully')"
                 onerror="this.style.border='2px solid red'; console.log('‚ùå Direct chart failed to load')">
        </div>
    </div>

    <div class="test-section">
        <h2>Pattern Matching Test</h2>
        <p>Testing if the URL matches our pattern:</p>
        <div id="pattern-result"></div>
    </div>

    <div class="test-section">
        <h2>Full AI Response Test</h2>
        <p>Testing chart extraction from full AI response:</p>
        <div id="ai-response-test"></div>
    </div>

    <script>
        // Test pattern matching
        const testUrl = "https://quickchart.io/chart?width=200&c=%7B%22type%22%3A%22bar%22%2C%22data%22%3A%7B%22labels%22%3A%5B%22Kedah%22%2C%22Selangor%22%5D%2C%22datasets%22%3A%5B%7B%22label%22%3A%22Population%202015%22%2C%22data%22%3A%5B2045300%2C6231800%5D%2C%22backgroundColor%22%3A%5B%22rgba(75%2C%20192%2C%20192%2C%200.2)%22%2C%22rgba(54%2C%20162%2C%20235%2C%200.2)%22%5D%2C%22borderColor%22%3A%5B%22rgba(75%2C%20192%2C%20192%2C%201)%22%2C%22rgba(54%2C%20162%2C%20235%2C%201)%22%5D%2C%22borderWidth%22%3A1%7D%5D%7D%2C%22options%22%3A%7B%22scales%22%3A%7B%22yAxes%22%3A%5B%7B%22ticks%22%3A%7B%22max%22%3A7000000%2C%22min%22%3A0%2C%22stepSize%22%3A1000000%2C%22beginAtZero%22%3Atrue%7D%2C%22stacked%22%3Afalse%7D%5D%2C%22xAxes%22%3A%7B%22stacked%22%3Afalse%7D%7D%2C%22plugins%22%3A%7B%22title%22%3A%7B%22display%22%3Atrue%2C%22text%22%3A%22Total%20Population%20Comparison%20between%20Kedah%20and%20Selangor%20in%202015%22%7D%2C%22legend%22%3A%7B%22display%22%3Atrue%2C%22position%22%3A%22top%22%7D%7D%7D%7D";

        const bareUrlPattern = /https?:\/\/quickchart\.io\/chart\?[^\s)]+/gi;
        const matches = testUrl.match(bareUrlPattern);

        const patternResult = document.getElementById('pattern-result');
        patternResult.innerHTML = `
            <p><strong>Pattern:</strong> ${bareUrlPattern}</p>
            <p><strong>Matches:</strong> ${matches ? matches.length : 0}</p>
            <p class="${matches ? 'success' : 'error'}">${matches ? '‚úÖ Pattern matches' : '‚ùå Pattern does not match'}</p>
        `;

        // Test full AI response
        const aiResponse = `Here is the requested comparison of total population between Kedah and Selangor in 2015:

**Total Population Comparison between Kedah and Selangor in 2015**

Based on the available data, here are the total population figures:

- **Kedah**: 2,045,300 people
- **Selangor**: 6,231,800 people

This shows that Selangor had approximately 3 times the population of Kedah in 2015.

**Chart Visualization**
https://quickchart.io/chart?width=200&c=%7B%22type%22%3A%22bar%22%2C%22data%22%3A%7B%22labels%22%3A%5B%22Kedah%22%2C%22Selangor%22%5D%2C%22datasets%22%3A%5B%7B%22label%22%3A%22Population%202015%22%2C%22data%22%3A%5B2045300%2C6231800%5D%2C%22backgroundColor%22%3A%5B%22rgba(75%2C%20192%2C%20192%2C%200.2)%22%2C%22rgba(54%2C%20162%2C%20235%2C%200.2)%22%5D%2C%22borderColor%22%3A%5B%22rgba(75%2C%20192%2C%20192%2C%201)%22%2C%22rgba(54%2C%20162%2C%20235%2C%201)%22%5D%2C%22borderWidth%22%3A1%7D%5D%7D%2C%22options%22%3A%7B%22scales%22%3A%7B%22yAxes%22%3A%5B%7B%22ticks%22%3A%7B%22max%22%3A7000000%2C%22min%22%3A0%2C%22stepSize%22%3A1000000%2C%22beginAtZero%22%3Atrue%7D%2C%22stacked%22%3Afalse%7D%5D%2C%22xAxes%22%3A%7B%22stacked%22%3Afalse%7D%7D%2C%22plugins%22%3A%7B%22title%22%3A%7B%22display%22%3Atrue%2C%22text%22%3A%22Total%20Population%20Comparison%20between%20Kedah%20and%20Selangor%20in%202015%22%7D%2C%22legend%22%3A%7B%22display%22%3Atrue%2C%22position%22%3A%22top%22%7D%7D%7D%7D`;

        const aiMatches = aiResponse.match(bareUrlPattern);
        const aiResultDiv = document.getElementById('ai-response-test');

        aiResultDiv.innerHTML = `
            <p><strong>URLs found in AI response:</strong> ${aiMatches ? aiMatches.length : 0}</p>
        `;

        if (aiMatches) {
            aiMatches.forEach((url, index) => {
                const img = document.createElement('img');
                img.src = url;
                img.alt = `Extracted Chart ${index + 1}`;
                img.style.maxWidth = '100%';
                img.style.margin = '10px 0';
                img.style.border = '1px solid #ddd';
                img.onload = () => {
                    img.style.border = '2px solid green';
                    console.log(`‚úÖ Extracted chart ${index + 1} loaded successfully`);
                };
                img.onerror = () => {
                    img.style.border = '2px solid red';
                    console.log(`‚ùå Extracted chart ${index + 1} failed to load`);
                };
                aiResultDiv.appendChild(img);
            });
        } else {
            aiResultDiv.innerHTML += '<p class="error">‚ùå No URLs found in AI response</p>';
        }

        console.log('üîç Test complete - check browser console for details');
    </script>
</body>
</html>